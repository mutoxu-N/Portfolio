---
# description: ""
showTableOfContents: true
tags: ["大学", "Python"]
title: "大量の3次元点群から3Dモデルを作成する"
type: "post"
date: 2023-01-14
---

## 画像・映像コンテンツ演習 1

画像・映像コンテンツ演習 1 の課題は、
大量の三次元点群を地面/建物判定し、3D モデルを作成することだった。

作品名: トウキョウスムージー
![実行結果例](/Portfolio/images/posts/pointcloud_to_3d/result.png)

## 入力データ

入力データは、航空機で取得した 3 次元点データである。
$X$, $Y$座標は 1m おきに整数で与えられる。$Z$座標は、$(X, Y)$ における高さを表す。

点数は 100 万頂点を超えるような大規模なデータが入力される。

データ例:

```c++
  -7542.00  -36050.00    23.56
  -7541.00  -36050.00    23.57
  -7540.00  -36050.00    23.56
  -7539.00  -36050.00    25.17
  -7538.00  -36050.00    27.10
  -7537.00  -36050.00    27.64
  -7536.00  -36050.00    27.47
```

## アルゴリズム

### 欠損点補完(担当箇所)

データ取得に失敗した頂点の $Z$座標は `-9999.99` になっているため、\
欠損点を検知して補完する必要がある。\
今回は、周囲の頂点の高さの平均値を使用して補完した。

### 地面判定(担当箇所)

綺麗な 3D モデルを作成するために、地面と建物を判定する。

隣り合う点の高さの差が閾値(2m)を超えたら判定するような走査を行うと、\
走査線が出てしまった。

画像のノイズ除去に使用されるオープニングを使用することで、\
細い走査線を減らすことができた。

![opening](/Portfolio/images/posts/pointcloud_to_3d/opening.png)

### データ削減

100 万点のままだと、3D モデルの表示が遅くなってしまうため頂点数を削減する。\
(データ削減も課題のひとつ)

隣接する 4 点の高さの平均値をもとに代表点を決め、頂点数を 75%削減する。

### 点群の加工

建物判定した点群をそのまま繋ぐと、建物が台形のような形になってしまう。\
建物の少し外側に頂点を追加し、壁面が垂直になるように加工する。

![建物を直角に](/Portfolio/images/posts/pointcloud_to_3d/anchor.png)

### 平滑化

建物の屋根や地面の凹凸を軽減するために平滑化を行う。

-   建物の屋根: 8 近傍の最大値で揃える
-   地面: 8 近傍の最小値で揃えた後、8 近傍の平均値で滑らかにする

### 3D モデルの作成

$(X, Y)$ の平面でドロネーの三角形分割を使用し、三角形メッシュを作成する。\
その結果を用いて、3D モデルを作成する。

## 感想

最終発表では、**卒業生審査員 優秀賞**を受賞した。\
参考資料 ①: トウキョウスムージー ([2022 年度画像・映像コンテンツ成果物](https://sites.google.com/g.chuo-u.ac.jp/cuise/classes/2022?authuser=0#h.gnxrkucrnssx))
参考資料 ②: [「Middle Birds」優秀賞](https://www.chuo-u.ac.jp/academics/faculties/science/departments/infotech/news/2023/03/64259/)

チームではサブリーダーを務め、\
チームの方針決定やチーム内の技術アドバイスなどを行った。

特に、平滑化の部分では実装のアドバイスやアイデアの共有を行い、\
良い結果を得ることができた。

また、実装した"建物判定アルゴリズム"では、\
画像処理技術を応用したアプローチを行い、綺麗な 3D モデルを作成することができた。\
一見関係なさそうな知識が応用できて面白かった。

![実行結果](/Portfolio/images/posts/pointcloud_to_3d/result_zoom.png)
